Bzoj5251 线段树+贪心

记录本Xm省选后的第一篇题解!
国际惯例的题面:

首先这个东西显然是一棵树。
如果我们把数值排序，并建立这棵树的dfs序，显然dfs序上的一个区间对应数值的一个区间，且根为数值区间左端点。
如果你这样想，恭喜你能获得50分，如果记得加了eps会获得55~60分。
因为当数值可以相同的时候，这个贪心是存在反例的。
考虑10个点的二叉堆，9个1一个2，显然2应该在位置6，而这样跑出来2会在位置10！
因为可能一个子树的数值是不连续的，我们可以在把根节点的位置减小为相同数值的左一个的时候，把这个区间的一个值分给别的子树。
考虑修正贪心。
我们离散化序列，记录每个值出现次数。
然后我们令f[i]表示>=i的数的个数。
先统计出子树size，考虑bfs遍历整个子树。
这样我们子树的根节点x要选择的就是满足f[1,i]均>=siz[x]的最大的i，我们令ans[x]=i。
之后我们需要让f[1,i]减去siz[x]，为了给这个子树预留位置。
当然，在遍历到一个节点的时候需要把为他的父亲预留的size加回去，也就是说，让f[1,ans[fa[x]]]加上siz[fa[x]]-1。
这个线段树二分怎么实现？由于这个序列不单调，我们维护区间min，如果左区间的min>=siz[x]的话就去右区间查询。
最后特判当前的点能否选择即可。
(考试的时候想到了线段树，但是非得用dfs序列遍历，怎么也弄不对......)

注意这题BZOJ卡eps!!!!!

代码:
