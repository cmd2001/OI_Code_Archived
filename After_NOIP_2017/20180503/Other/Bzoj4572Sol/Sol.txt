4572: [Scoi2016]围棋 轮廓线DP KMP

国际惯例的题面:

这种题目显然DP了，看到M这么小显然要状压。
然后就是具体怎么DP的问题。
首先我们可以暴力状压上一行状态，然后逐行转移。复杂度n*3^m+3^(m*2)，显然过不去。

考虑状态的特殊性，每个位置是黑子白子我们并不关心，我们只关心与模板的匹配情况。
于是我们可以f(i,S,x,y)表示我们决策到i行j列，S表示上一行哪些位置和这一行哪些位置能与模板第一行完全匹配，x表示当前行与模板第一行匹配长度，y表示当前行与模板第二行匹配长度。
转移的话就枚举当前行下一个位置填什么颜色棋子(或空着)即可，复杂度n*(3^m)m*c*c*(2^m)*3，显然也凉了。
但是，我们发现如果一行能与模板第一行完全匹配，显然这个匹配位置最少在这一行的位置c。这样就能把次数中的m变成m-c+1。
这样仍旧不能AC。因为这只是普通的状压DP，显然有很多无用状态。

轮廓线DP的巧妙之处在于:因为采用了逐格转移，它压缩的状态可以部分是上一行的，部分是这一行的。
于是我们可以f(i,j,S,x,y)表示我们决策到i行j列，S表示上一行>=j的哪些位置和这一行<j的哪些位置能与模板第一行完全匹配，x表示当前行与模板第一行匹配长度，y表示当前行与模板第二行匹配长度。
我们枚举下一个格子填什么颜色的棋子，进行转移即可。复杂度n*m*3(m-c+1)*(c^2)*3。

代码:


もうこの手を　xさないから笑い合えるよ
我已不会再放手 所以一起欢笑吧
またこの鏊から　ふたりiき出そう　この道を
让我们再次从这里出发 踏上这条道路
朝の澄んだ射し　夜空に瞬く星
清晨干净的阳光 夜空中闪烁的繁星
たわいもないこと　分け合って感じるぬくもり
不管多琐碎的事 互相分享的温暖
ひとりきりの　思い出してしまうたび
每当我回想起独自一人的记忆
いつもで　幛扦皮れてたから　笑えた
你总在我身边 抚摸着我朝我微笑

Xm的第一道轮廓线DP