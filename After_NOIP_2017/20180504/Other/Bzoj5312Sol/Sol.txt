Bzoj5312: 冒险 线段树 复杂度分析

国际惯例的题面:

一看到这种维护序列的题，数据范围分块过不去，显然线段树了。
考虑位运算的性质，and相当于钦定一些位必须是0，or相当于钦定一些位必须是1，这都是一些区间赋值操作。
然而我们不可以按位确定，为什么？因为当你确定了最高位之后，你需要在满足高位的情况下求出低位，这相当于是一个取子集操作，单层的树是不可做的。(树套树20层？恭喜你不如n^2暴力了)
于是去ORZ了英文题解，发现他是这样分析的:
我们对每一个位上的操作把数分成两类，有影响的和无影响的。因为操作对这两种数不同，所以我们不能直接维护。
但是，显然在一个操作之后，两种不同的数会被变得相同！
于是，当我们操作到某一个区间，如果这个操作对区间内的所有数并不是全部相同，那么我们递归下去做(也就是访问多余节点)。因为操作后两边这些位的数会变得相同，而变相同的次数有限，所以复杂度是正确的。(表示原文一堆势能分析不明觉厉)
然后就是怎么判断操作对某个区间是否相同的问题了。我们维护区间的and和和or和，显然两者的xor和就是这个区间存在不同的位。如果这些存在不同的位与本次操作会被钦定的位and起来不为0的话，就说明这次操作对这个区间的所有数并非完全相同，需要递归下去做。
另外，这题略卡常......
代码:


はらり はらり さやかな白よ
飘零的 飞散的 明亮的白色啊
簸 Kわる その鏊で
在这里 梦的终结之所
淡く 流れ わたしの恋を
淡淡地 流淌的 我的爱恋
こころ ふかく そめてゆく
深深地 染进心中

不符合直觉的复杂度证明
