4889: [Tjoi2017]不勤劳的图书管理员 树套树

国际惯例的题面(Bzoj没有，洛谷找的):

动态加权逆序对，一眼树套树。
256MB内存，5e4范围，不虚不虚。
首先把交换改成两个插入和两个删除。
考虑插入和删除的贡献，就是统计前面比这个值大的数的数值和，数量和，后面比这个值小的数的数值和，数量和。然后特判一下当前两个值构成逆序对的情况即可(因为这种情况会被计算两遍)。
考虑树状数组套动态开点线段树维护这个东西，线段树只需要单点修改区间求和即可，十分简单。
然而数组开不下啊......理论上我们数组范围要开到2e7左右，然而并跑不满，开到1.4e7就足以AC啦。
(但是跑得奇慢无比，怕不是人傻自带大常数)

代码(话说两个log差不多是根号，我这是两个log还有4倍的常数，大概已经比根号慢了):


(另外我为什么又在刷水题了!)

空に舞う雪はまるで白い花びら ひらひら Lに吹かれて散よ
在茫茫天空飞舞着 好似纯白花朵的雪花 迎风飘洒
Ah…染めあげて 消えてoくなるのなら この寂しさも一wに溶けてゆけ
啊…全都染上白 如果那些色彩渐渐消失不见的话 那也让这寂寞溶于一起消失吧

s束を交わす事もなくて 不安が募るばかり
想到相互所约定的那些事情 就会感到越来越不安
ありふれた言~でもいい 今はただ信じさせて
就算是平常无奇的言语也好 这是如今唯一让我相信的

このTれた道も 二人なら幸せ
这条熟悉的道路上 是我们两人的话 那我会感到幸福的
届かぬ想いを护à椁欷郡 未来浃铯毪韦な？
那些无法传达的思念 若是能够传达给你 未来会不会就此发生改变

论两个log慢过根号的故事