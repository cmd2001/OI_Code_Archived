3451: Tyvj1953 Normal 点分治 FFT

国际惯例的题面:

代价理解为重心和每个点这个点对的代价。根据期望的线性性，我们枚举每个点，计算会产生的ij点对的代价即可。
那么，i到j的链上，i必须是第一个被选择的点。
对于i来说，就是1/dis(i,j)。
所以答案就是sigma(i,j) 1/(dis(i,j)+1)。
然而这样计算是n^2的，考虑优化。
如果我们能计算出边长为某个数值的边的数量的话，是不是就能计算答案呢？
统计路径的题，一眼点分治。
考虑怎样计算，我们能dfs出每个子树中距离分治重心为x的点有多少个，然后我们枚举两个点让他们取去组成路径即可。
这显然是个卷积，FFT优化。我们补集转化，先计算全部方案，再减去本身对本身(两个点来自相同子树)的方案。
为什么这样算复杂度正确？因为当当前分治层数一定时，所有子树的最深点的深度总和是O(n)的，并且那个log还会更小。这样分析的话发现复杂度是O(nlog^2n)。
正常的二元关系计算方式是前缀和和当前的卷积贡献，为什么这次不能这样呢？
给你一棵扫把形的树，一半的点形成一条链，显然你会选择扫把的重心(一边是一堆叶子，一边是链)当做重心。
然后你发现链的那边长度为n/2，如果你对每个叶子都和链做一次卷积的话，恭喜你卡成n^2logn，不如暴力......

代码:


ここでこのまま
即使在这里就这样
Wが消えてしまっても lも知らずに
我消失不见了 谁也不会知道吧
明日が来るのだろう
明天依然会来临吧
わずか 世界のひとかけらに^ぎない
我仅仅是 这个世界的微小碎屑
ひとりを夜が包む
夜晚怀抱孤独的身影

相对显然的期望转化