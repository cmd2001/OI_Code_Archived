4712: 洪水 基于链分治的动态DP

国际惯例的题面:

看起来很神的样子......如果我说这是动态DP的板子题你敢信？
基于链分治的动态DP？说人话，就是树链剖分线段树维护DP。
既然是DP，那就先得有转移方程。
我们令f[i]表示让i子树中的叶子节点全部与根不联通，所需要的最小代价，v[i]为输入的点权。
显然f[i]=min(v[i],sigma(f[soni]))，边界条件是，如果i是叶子节点，则f[i]=v[i]。
我们需要用链分治去维护这个DP，所以要把DP拆成重链和轻链独立的形式。
我们还是用f[i]表示让i子树中的叶子节点全部与根不联通，所需要的最小代价，h[i]表示i的轻儿子的f值之和。
根据定义，h[i]=sigma(h[light_sons_i])，
同时我们有：f[i]=min(v[i],f[heavy_son_i]+h[i])。
这个转移我们能写成一个最短路矩阵相乘的形式:
{0,f[heavy_son_i]}*{{0,v[i]},{inf,h[i]}} = {0,f[i]}
(我的写法和C++多维数组的表示方法相同，inf表示不能转移)
显然(陈俊锟说过)这个矩阵连乘是具有结合性的，所以我们能用线段树维护一条链上转移矩阵的连乘积。
于是修改的时候，我们只需要从这个点一路改上去，在跳轻边的时候修改其父亲的h值和转移矩阵，然后线段树更新即可。
查询的话就查询这个点到其所在重链底端线段树上转移矩阵的连乘积，然后左乘一个初始化矩阵即可。
时间复杂度O(8nlog^2n)，加上fread快读还是不慢(能看)的。
(其实分析题目性质能够让转移复杂度更低，然而不如矩阵的方法通用(反正就是个常数，不管他了)。关于分析性质的解法，见我BZOJ5210的题解)
代码:



雪の降るこの街にも 暖かい光が差し
雪花飘飞的这条街道上 温暖光芒从天而降
折れた羽をKしてる ついた心のW
受伤心灵的深处 被祈愿之羽逐渐治愈
足音がこえてくる 明日への扉叩いて
我听到了谁的脚步声 有人在敲打通往明日的门扉
目の前の道をMむ 季が巡る rの中で
季节更迭 我在时光之流中踏上眼前的道路
巡る想い あなただけ 笑が今もまぶしい
流连的思念 只有你的笑颜直到现在还如此炫目

基于链分治的动态DP板子题